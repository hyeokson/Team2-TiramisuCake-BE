<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="ko"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>CommentsResponseDto.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">backend</a> &gt; <a href="index.source.html" class="el_package">com.softeer.backend.fo_domain.comment.dto</a> &gt; <span class="el_source">CommentsResponseDto.java</span></div><h1>CommentsResponseDto.java</h1><pre class="source lang-java linenums">package com.softeer.backend.fo_domain.comment.dto;

import com.softeer.backend.fo_domain.comment.constant.CommentNickname;
import com.softeer.backend.fo_domain.comment.domain.Comment;
import com.softeer.backend.fo_domain.comment.util.ScrollPaginationUtil;
import lombok.*;

import java.util.List;

@NoArgsConstructor(access = AccessLevel.PRIVATE)
@AllArgsConstructor(access = AccessLevel.PUBLIC)
@Builder
@Getter
public class CommentsResponseDto {
    public static final int LAST_CURSOR = -1;

    private int nextCursor;

    private int totalComments;

    private List&lt;CommentResponse&gt; comments;

    @Getter
    @AllArgsConstructor
    @Builder
    public static class CommentResponse {

        private Boolean isMine;

        private String nickName;

        private int commentType;
    }

    public static CommentsResponseDto of(ScrollPaginationUtil&lt;Comment&gt; commentsScroll, Integer userId) {
<span class="nc bnc" id="L36" title="All 2 branches missed.">        if (commentsScroll.isLastScroll()) {</span>
<span class="nc" id="L37">            return CommentsResponseDto.newLastScroll(commentsScroll.getCurrentScrollItems(), userId);</span>
        }
<span class="nc" id="L39">        return CommentsResponseDto.newScrollHasNext(commentsScroll.getCurrentScrollItems(), commentsScroll.getNextCursor().getId(),</span>
                userId);
    }

    // 마지막 스크롤일 때의 응답값을 구성하는 메서드
    // nextCursor 값을 -1로 설정한다.
    private static CommentsResponseDto newLastScroll(List&lt;Comment&gt; commentsScroll, Integer userId) {
<span class="nc" id="L46">        return newScrollHasNext(commentsScroll, LAST_CURSOR, userId);</span>
    }

    // 마지막 스크롤이 아닐 때의 응답값을 구성하는 메서드
    private static CommentsResponseDto newScrollHasNext(List&lt;Comment&gt; commentsScroll, int nextCursor,
                                                        Integer userId) {
<span class="nc" id="L52">        return CommentsResponseDto.builder()</span>
<span class="nc" id="L53">                .nextCursor(nextCursor)</span>
<span class="nc" id="L54">                .totalComments(commentsScroll.size())</span>
<span class="nc" id="L55">                .comments(getContents(commentsScroll, userId))</span>
<span class="nc" id="L56">                .build();</span>
    }

    // CommentResponse를 생성하여 반환하는 메서드
    // 유저가 로그인을 한 상태에서 자신의 댓글이 응답에 포함될 경우,
    // isMine 변수값을 true로, nickname의 접미사에 '(나)'를 붙여서 응답을 구성한다.
    private static List&lt;CommentResponse&gt; getContents(List&lt;Comment&gt; commentsScroll, Integer userId) {
<span class="nc" id="L63">        return commentsScroll.stream()</span>
<span class="nc" id="L64">                .map(_comment -&gt; {</span>
<span class="nc" id="L65">                    boolean isMine = false;</span>
<span class="nc" id="L66">                    String nickname = _comment.getNickname();</span>
<span class="nc" id="L67">                    int commentType = _comment.getCommentType();</span>

<span class="nc bnc" id="L69" title="All 4 branches missed.">                    if (userId != null &amp;&amp; _comment.getUserId() != null &amp;&amp;</span>
<span class="nc bnc" id="L70" title="All 2 branches missed.">                            _comment.getUserId().equals(userId)) {</span>
<span class="nc" id="L71">                        isMine = true;</span>
<span class="nc" id="L72">                        nickname = nickname + CommentNickname.MY_NICKNAME_SUFFIX;</span>
                    }

<span class="nc" id="L75">                    return CommentResponse.builder()</span>
<span class="nc" id="L76">                            .isMine(isMine)</span>
<span class="nc" id="L77">                            .nickName(nickname)</span>
<span class="nc" id="L78">                            .commentType(commentType)</span>
<span class="nc" id="L79">                            .build();</span>
                })
<span class="nc" id="L81">                .toList();</span>

    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span></div></body></html>